@page "/content-ideas"
@using LearnStack.Services
@attribute [Authorize]
@inject IContentIdeaService ContentIdeaService
@inject ILearningResourceService ResourceService
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IDialogService DialogService
@inject NavigationManager NavigationManager

<PageTitle>Content Ideas - LearnStack</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="py-4">
    @* Page Header *@
    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4 page-header animate-fade-in-up">
        <MudStack Spacing="1">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                <div style="background: #fb8c00; border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center;">
                    <MudIcon Icon="@Icons.Material.Filled.Lightbulb" Style="color: white;" Size="Size.Medium" />
                </div>
                <MudText Typo="Typo.h5" Class="page-title">Content Ideas</MudText>
            </MudStack>
            <MudText Typo="Typo.body2" Class="page-subtitle">Manage your content creation pipeline</MudText>
        </MudStack>
        <MudStack Row="true" Spacing="2">
            <MudButton Variant="Variant.Outlined" 
                      StartIcon="@Icons.Material.Filled.MenuBook" 
                      OnClick="@(() => NavigationManager.NavigateTo("/resources"))" 
                      Style="border-radius: 6px;">
                Learning Resources
            </MudButton>
            <MudButton Variant="Variant.Filled" 
                      Color="Color.Warning"
                      StartIcon="@Icons.Material.Filled.Add" 
                      OnClick="OpenAddDialog"
                      Style="border-radius: 6px;">
                New Idea
            </MudButton>
        </MudStack>
    </MudStack>

    @* Statistics Cards *@
    <MudGrid Spacing="3" Class="mb-4">
        <MudItem xs="6" sm="3">
            <div class="stat-card">
                <div class="stat-icon" style="background: #e3f2fd;">
                    <MudIcon Icon="@Icons.Material.Filled.EmojiObjects" Style="color: #1e88e5;" />
                </div>
                <div class="stat-content">
                    <span class="stat-value">@ideaCount</span>
                    <span class="stat-label">Ideas</span>
                </div>
            </div>
        </MudItem>
        <MudItem xs="6" sm="3">
            <div class="stat-card">
                <div class="stat-icon" style="background: #fff3e0;">
                    <MudIcon Icon="@Icons.Material.Filled.Edit" Style="color: #fb8c00;" />
                </div>
                <div class="stat-content">
                    <span class="stat-value">@inProgressCount</span>
                    <span class="stat-label">In Progress</span>
                </div>
            </div>
        </MudItem>
        <MudItem xs="6" sm="3">
            <div class="stat-card">
                <div class="stat-icon" style="background: #e8f5e9;">
                    <MudIcon Icon="@Icons.Material.Filled.Publish" Style="color: #43a047;" />
                </div>
                <div class="stat-content">
                    <span class="stat-value">@publishedCount</span>
                    <span class="stat-label">Published</span>
                </div>
            </div>
        </MudItem>
        <MudItem xs="6" sm="3">
            <div class="stat-card">
                <div class="stat-icon" style="background: #ede7f6;">
                    <MudIcon Icon="@Icons.Material.Filled.Lightbulb" Style="color: #7b1fa2;" />
                </div>
            </div>
        </MudItem>
    </MudGrid>

    @* Search and Filters Row *@
    <div class="filter-section animate-fade-in-up">
        <MudGrid Spacing="3" Justify="Justify.SpaceBetween">
            <MudItem xs="12" md="4">
                <MudTextField @bind-Value="searchTerm"
                             Placeholder="Search ideas..."
                             Variant="Variant.Outlined"
                             Adornment="Adornment.Start"
                             AdornmentIcon="@Icons.Material.Filled.Search"
                             Immediate="true"
                             DebounceInterval="300"
                             OnDebounceIntervalElapsed="ApplyFiltersWithReset"
                             Style="background-color: white;" />
            </MudItem>
            <MudItem xs="12" md="8">
                <MudStack Row="true" Spacing="2" Justify="Justify.FlexEnd" AlignItems="AlignItems.Center">
                    <MudButtonGroup Variant="Variant.Outlined" Size="Size.Small">
                        <MudIconButton Icon="@Icons.Material.Filled.GridView" 
                                      Color="@(viewMode == ViewMode.Grid ? Color.Warning : Color.Default)"
                                      OnClick="@(() => { viewMode = ViewMode.Grid; StateHasChanged(); })"
                                      Title="Grid View" />
                        <MudIconButton Icon="@Icons.Material.Filled.TableChart" 
                                      Color="@(viewMode == ViewMode.DataGrid ? Color.Warning : Color.Default)"
                                      OnClick="@(() => { viewMode = ViewMode.DataGrid; StateHasChanged(); })"
                                      Title="Table View" />
                    </MudButtonGroup>
                    <MudSelect @bind-Value="filterStatus"
                              @bind-Value:after="OnFilterChanged"
                              Label="Status"
                              Variant="Variant.Outlined"
                              T="IdeaStatus?"
                              Clearable="true"
                              Style="width: 150px; background-color: white;">
                        <MudSelectItem T="IdeaStatus?" Value="@((IdeaStatus?)IdeaStatus.Idea)">Idea</MudSelectItem>
                        <MudSelectItem T="IdeaStatus?" Value="@((IdeaStatus?)IdeaStatus.InProgress)">In Progress</MudSelectItem>
                        <MudSelectItem T="IdeaStatus?" Value="@((IdeaStatus?)IdeaStatus.Published)">Published</MudSelectItem>
                    </MudSelect>
                    <MudSelect @bind-Value="filterContentType"
                              @bind-Value:after="OnFilterChanged"
                              Label="Type"
                              Variant="Variant.Outlined"
                              T="ContentIdeaType?"
                              Clearable="true"
                              Style="width: 150px; background-color: white; border-radius: 10px;">
                        <MudSelectItem T="ContentIdeaType?" Value="@((ContentIdeaType?)ContentIdeaType.BlogPost)">Blog Post</MudSelectItem>
                        <MudSelectItem T="ContentIdeaType?" Value="@((ContentIdeaType?)ContentIdeaType.Video)">Video</MudSelectItem>
                        <MudSelectItem T="ContentIdeaType?" Value="@((ContentIdeaType?)ContentIdeaType.TweetThread)">Tweet Thread</MudSelectItem>
                        <MudSelectItem T="ContentIdeaType?" Value="@((ContentIdeaType?)ContentIdeaType.Tutorial)">Tutorial</MudSelectItem>
                        <MudSelectItem T="ContentIdeaType?" Value="@((ContentIdeaType?)ContentIdeaType.Other)">Other</MudSelectItem>
                    </MudSelect>
                    <MudSelect @bind-Value="filterPriority"
                              @bind-Value:after="OnFilterChanged"
                              Label="Priority"
                              Variant="Variant.Outlined"
                              T="Priority?"
                              Clearable="true"
                              Style="width: 130px; background-color: white; border-radius: 10px;">
                        <MudSelectItem T="Priority?" Value="@((Priority?)Priority.High)">High</MudSelectItem>
                        <MudSelectItem T="Priority?" Value="@((Priority?)Priority.Medium)">Medium</MudSelectItem>
                        <MudSelectItem T="Priority?" Value="@((Priority?)Priority.Low)">Low</MudSelectItem>
                    </MudSelect>
                </MudStack>
            </MudItem>
        </MudGrid>
    </div>

    @* Ideas List *@
    @if (isLoading)
    {
        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Style="padding: 4rem;">
            <MudProgressCircular Color="Color.Warning" Indeterminate="true" Size="Size.Large" />
            <MudText Typo="Typo.body2" Style="color: #64748b; margin-top: 1rem;">Loading your ideas...</MudText>
        </MudStack>
    }
    else if (!filteredIdeas.Any())
    {
        <div class="empty-state animate-fade-in-up">
            <div class="empty-state-icon">
                <MudIcon Icon="@Icons.Material.Filled.Lightbulb" Size="Size.Large" Style="color: #94a3b8;" />
            </div>
            <MudText Typo="Typo.h6" Style="color: #334155; font-weight: 600; margin-bottom: 0.5rem;">No content ideas yet</MudText>
            <MudText Typo="Typo.body2" Style="color: #64748b; margin-bottom: 1.5rem;">Start planning your content creation journey</MudText>
            <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add" OnClick="OpenAddDialog"
                      Style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 10px; padding: 10px 24px;">
                Add Your First Idea
            </MudButton>
        </div>
    }
    else if (viewMode == ViewMode.Grid)
    {
        <MudDropContainer @key="@filterKey" T="ContentIdea" Items="pagedIdeas" ItemsSelector="@((item, dropzone) => true)" 
                         ItemDropped="OnIdeaDropped">
            <ChildContent>
                <MudDropZone T="ContentIdea" Identifier="main-zone" AllowReorder="true">
                    <MudGrid Spacing="3">
                    </MudGrid>
                </MudDropZone>
            </ChildContent>
            <ItemRenderer>
                <div class="mud-grid-item mud-grid-item-xs-12 mud-grid-item-sm-6 mud-grid-item-md-4">
                    <div class="resource-card animate-fade-in-up" style="padding: 20px; height: 100%; cursor: move;">
                        <MudStack Spacing="2" Style="height: 100%;">
                            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Start">
                                <MudChip T="string" Size="Size.Small" Style="@GetContentTypeChipStyle(context.ContentType)">
                                    @context.ContentType
                                </MudChip>
                                <MudStack Row="true" Spacing="0">
                                    <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Style="color: #667eea;" OnClick="@(() => OpenEditDialog(context))" />
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Style="color: #ef4444;" OnClick="@(() => DeleteIdea(context.Id))" />
                                </MudStack>
                            </MudStack>
                            
                            <MudText Typo="Typo.subtitle1" Style="font-weight: 700; color: #1e293b;">@context.Title</MudText>
                            
                            @if (!string.IsNullOrEmpty(context.Description))
                            {
                                <MudText Typo="Typo.body2" Style="color: #64748b; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                    @context.Description
                                </MudText>
                            }
                            
                            @if (context.SourceResources.Any())
                            {
                                <MudStack Spacing="1">
                                    <MudText Typo="Typo.caption" Style="color: #94a3b8;">
                                        <MudIcon Icon="@Icons.Material.Filled.Link" Size="Size.Small" /> @context.SourceResources.Count source(s)
                                    </MudText>
                                    @foreach (var sourceResource in context.SourceResources.Take(2))
                                    {
                                        if (sourceResource.LearningResource != null)
                                        {
                                            <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Icon="@Icons.Material.Filled.Book" 
                                                    Style="max-width: 100%; overflow: hidden; text-overflow: ellipsis; border-color: #e2e8f0; color: #64748b;">
                                                @sourceResource.LearningResource.Title
                                            </MudChip>
                                        }
                                    }
                                    @if (context.SourceResources.Count > 2)
                                    {
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                                            +@(context.SourceResources.Count - 2) more...
                                        </MudText>
                                    }
                                </MudStack>
                            }
                            
                            <MudSpacer />
                            
                            <MudStack Row="true" Spacing="1" Style="flex-wrap: wrap;">
                                <MudChip T="string" Size="Size.Small" Style="@GetStatusChipStyle(context.Status)">
                                    @context.Status
                                </MudChip>
                                <MudChip T="string" Size="Size.Small" Style="@GetPriorityChipStyle(context.Priority)">
                                    @context.Priority
                                </MudChip>
                            </MudStack>
                            
                            <MudDivider Style="border-color: #e2e8f0;" />
                            
                            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                                <MudText Typo="Typo.caption" Style="color: #94a3b8;">
                                    @GetRelativeDate(context.DateCreated)
                                </MudText>
                                <MudStack Row="true" Spacing="1">
                                    @if (context.Status != IdeaStatus.InProgress)
                                    {
                                        <MudButton Size="Size.Small" Variant="Variant.Text" OnClick="@(() => UpdateStatus(context, IdeaStatus.InProgress))" 
                                                  Style="text-transform: none; font-size: 0.7rem; color: #f59e0b;">
                                            Start
                                        </MudButton>
                                    }
                                    @if (context.Status != IdeaStatus.Published)
                                    {
                                        <MudButton Size="Size.Small" Variant="Variant.Text" OnClick="@(() => UpdateStatus(context, IdeaStatus.Published))" 
                                                  Style="text-transform: none; font-size: 0.7rem; color: #10b981;">
                                            Publish
                                        </MudButton>
                                    }
                                </MudStack>
                            </MudStack>
                        </MudStack>
                    </div>
                </div>
            </ItemRenderer>
        </MudDropContainer>
        
        @* Pagination *@
        <div class="resource-card" style="padding: 16px; margin-top: 20px;">
            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                <MudText Typo="Typo.body2" Style="color: #64748b; font-weight: 500;">
                    Showing @((currentPage - 1) * pageSize + 1) - @(Math.Min(currentPage * pageSize, filteredIdeas.Count)) of @filteredIdeas.Count ideas
                </MudText>
                <MudPagination Count="@totalPages" Selected="@currentPage" SelectedChanged="OnPageChanged" BoundaryCount="1" MiddleCount="3"
                              Color="Color.Warning" Variant="Variant.Filled" />
            </MudStack>
        </div>
    }
    else if (viewMode == ViewMode.DataGrid)
    {
        <MudPaper Elevation="0" Style="border-radius: 16px; overflow: hidden; border: 1px solid rgba(245, 158, 11, 0.1);">
        <MudDataGrid T="ContentIdea" Items="@pagedIdeas" Striped="true" Dense="false" Hover="true" ReadOnly="false"
                     Style="background: white;">
            <Columns>
                <PropertyColumn Property="x => x.Title" Title="Title">
                    <CellTemplate>
                        <MudText Typo="Typo.body2" Style="font-weight: 600; color: #1e293b;">@context.Item.Title</MudText>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.ContentType" Title="Type">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Style="@GetContentTypeChipStyle(context.Item.ContentType)">
                            @context.Item.ContentType
                        </MudChip>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.Status" Title="Status">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Style="@GetStatusChipStyle(context.Item.Status)">
                            @context.Item.Status
                        </MudChip>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.Priority" Title="Priority">
                    <CellTemplate>
                        <MudChip T="string" Size="Size.Small" Style="@GetPriorityChipStyle(context.Item.Priority)">
                            @context.Item.Priority
                        </MudChip>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.DateCreated" Title="Date Created">
                    <CellTemplate>
                        <MudText Typo="Typo.body2" Style="color: #64748b;">@GetRelativeDate(context.Item.DateCreated)</MudText>
                    </CellTemplate>
                </PropertyColumn>
                <TemplateColumn Title="Sources" Sortable="false">
                    <CellTemplate>
                        <MudText Typo="Typo.body2" Style="color: #64748b;">@context.Item.SourceResources.Count</MudText>
                    </CellTemplate>
                </TemplateColumn>
                <TemplateColumn Title="Actions" Sortable="false">
                    <CellTemplate>
                        <MudStack Row="true" Spacing="1">
                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Style="color: #f59e0b;" OnClick="@(() => OpenEditDialog(context.Item))" />
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Style="color: #ef4444;" OnClick="@(() => DeleteIdea(context.Item.Id))" />
                            @if (context.Item.Status != IdeaStatus.Published)
                            {
                                <MudIconButton Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" Style="color: #10b981;" 
                                              OnClick="@(() => UpdateStatus(context.Item, IdeaStatus.Published))" 
                                              Title="Mark as Published" />
                            }
                        </MudStack>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
        </MudPaper>
        
        @* Pagination *@
        <div class="resource-card" style="padding: 16px; margin-top: 20px;">
            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                <MudText Typo="Typo.body2" Style="color: #64748b; font-weight: 500;">
                    Showing @((currentPage - 1) * pageSize + 1) - @(Math.Min(currentPage * pageSize, filteredIdeas.Count)) of @filteredIdeas.Count ideas
                </MudText>
                <MudPagination Count="@totalPages" Selected="@currentPage" SelectedChanged="OnPageChanged" BoundaryCount="1" MiddleCount="3"
                              Color="Color.Warning" Variant="Variant.Filled" />
            </MudStack>
        </div>
    }
</MudContainer>

@code {
    private enum ViewMode
    {
        Grid,
        DataGrid
    }

    private List<ContentIdea> ideas = new();
    private List<ContentIdea> filteredIdeas = new();
    private List<ContentIdea> pagedIdeas = new();
    private string searchTerm = string.Empty;
    private IdeaStatus? filterStatus;
    private ContentIdeaType? filterContentType;
    private Priority? filterPriority;
    private bool isLoading = true;
    private string userId = string.Empty;
    private ViewMode viewMode = ViewMode.Grid;
    private int filterKey = 0;
    
    // Pagination
    private int currentPage = 1;
    private int pageSize = 50;
    private int totalPages = 1;

    // Statistics
    private int ideaCount;
    private int inProgressCount;
    private int publishedCount;
    private int totalCount;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        userId = authState.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? string.Empty;

        await LoadIdeas();
        await LoadStatistics();
    }

    private async Task LoadIdeas()
    {
        if (string.IsNullOrEmpty(userId)) return;

        isLoading = true;
        ideas = await ContentIdeaService.GetAllAsync(userId);
        ApplyFilters();
        isLoading = false;
    }

    private async Task LoadStatistics()
    {
        if (string.IsNullOrEmpty(userId)) return;

        ideaCount = ideas.Count(i => i.Status == IdeaStatus.Idea);
        inProgressCount = ideas.Count(i => i.Status == IdeaStatus.InProgress);
        publishedCount = ideas.Count(i => i.Status == IdeaStatus.Published);
        totalCount = ideas.Count;
    }

    private void ApplyFilters(bool resetPage = false)
    {
        // Reset to page 1 if requested (typically when filters change)
        if (resetPage)
        {
            currentPage = 1;
        }

        filteredIdeas = ideas;

        if (filterStatus.HasValue)
        {
            filteredIdeas = filteredIdeas.Where(i => i.Status == filterStatus.Value).ToList();
        }

        if (filterContentType.HasValue)
        {
            filteredIdeas = filteredIdeas.Where(i => i.ContentType == filterContentType.Value).ToList();
        }

        if (filterPriority.HasValue)
        {
            filteredIdeas = filteredIdeas.Where(i => i.Priority == filterPriority.Value).ToList();
        }

        if (!string.IsNullOrWhiteSpace(searchTerm))
        {
            var term = searchTerm.ToLower();
            filteredIdeas = filteredIdeas.Where(i =>
                i.Title.ToLower().Contains(term) ||
                (i.Description?.ToLower().Contains(term) ?? false) ||
                (i.Notes?.ToLower().Contains(term) ?? false) ||
                i.SourceResources.Any(sr => sr.LearningResource != null && 
                    sr.LearningResource.Title.ToLower().Contains(term))
            ).ToList();
        }

        // Calculate pagination
        totalPages = (int)Math.Ceiling(filteredIdeas.Count / (double)pageSize);
        if (currentPage > totalPages && totalPages > 0)
        {
            currentPage = totalPages;
        }
        if (currentPage < 1)
        {
            currentPage = 1;
        }
        
        // Apply pagination
        pagedIdeas = filteredIdeas
            .Skip((currentPage - 1) * pageSize)
            .Take(pageSize)
            .ToList();

        filterKey++;
        StateHasChanged();
    }
    
    private void ApplyFiltersWithReset(string value)
    {
        ApplyFilters(true);
    }
    
    private void OnFilterChanged()
    {
        ApplyFilters(true);
    }
    
    private void OnPageChanged(int page)
    {
        currentPage = page;
        pagedIdeas = filteredIdeas
            .Skip((currentPage - 1) * pageSize)
            .Take(pageSize)
            .ToList();
        StateHasChanged();
    }

    private async Task OnIdeaDropped(MudItemDropInfo<ContentIdea> dropItem)
    {
        if (dropItem.Item == null) return;

        // Get the index in the paged list
        var oldIndex = pagedIdeas.IndexOf(dropItem.Item);
        if (oldIndex == -1) return;

        // Calculate the global index offset for the current page
        var pageOffset = (currentPage - 1) * pageSize;

        // Remove from old position
        pagedIdeas.RemoveAt(oldIndex);

        // Insert at new position
        var newIndex = dropItem.IndexInZone;
        if (newIndex > pagedIdeas.Count)
            newIndex = pagedIdeas.Count;
            
        pagedIdeas.Insert(newIndex, dropItem.Item);

        // Update the order in the full filtered list
        var globalOldIndex = oldIndex + pageOffset;
        var globalNewIndex = newIndex + pageOffset;

        filteredIdeas.RemoveAt(globalOldIndex);
        filteredIdeas.Insert(globalNewIndex, dropItem.Item);

        // Update the order in database
        var orderedIds = filteredIdeas.Select(i => i.Id).ToList();
        await ContentIdeaService.UpdateOrderAsync(userId, orderedIds);

        // Refresh the display
        StateHasChanged();
    }

    private async Task OpenAddDialog()
    {
        var parameters = new DialogParameters
        {
            { nameof(ContentIdeaForm.UserId), userId }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<ContentIdeaForm>("Add Content Idea", parameters, options);
        var result = await dialog.Result;

        if (result is not null && !result.Canceled)
        {
            await LoadIdeas();
            await LoadStatistics();
        }
    }

    private async Task OpenEditDialog(ContentIdea idea)
    {
        var parameters = new DialogParameters
        {
            { nameof(ContentIdeaForm.Idea), idea },
            { nameof(ContentIdeaForm.UserId), userId }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<ContentIdeaForm>("Edit Content Idea", parameters, options);
        var result = await dialog.Result;

        if (result is not null && !result.Canceled)
        {
            await LoadIdeas();
            await LoadStatistics();
        }
    }

    private async Task DeleteIdea(int id)
    {
        await ContentIdeaService.DeleteAsync(id, userId);
        await LoadIdeas();
        await LoadStatistics();
    }

    private async Task UpdateStatus(ContentIdea idea, IdeaStatus newStatus)
    {
        idea.Status = newStatus;
        idea.DatePublished = newStatus == IdeaStatus.Published ? DateTime.UtcNow : null;
        await ContentIdeaService.UpdateAsync(idea, userId);
        await LoadStatistics();
        ApplyFilters();
    }

    private string GetRelativeDate(DateTime date)
    {
        var diff = DateTime.UtcNow - date;
        if (diff.TotalDays < 1) return "Today";
        if (diff.TotalDays < 2) return "Yesterday";
        if (diff.TotalDays < 7) return $"{(int)diff.TotalDays} days ago";
        if (diff.TotalDays < 30) return $"{(int)(diff.TotalDays / 7)} weeks ago";
        if (diff.TotalDays < 365) return $"{(int)(diff.TotalDays / 30)} months ago";
        return $"{(int)(diff.TotalDays / 365)} years ago";
    }

    private Color GetContentTypeColor(ContentIdeaType type) => type switch
    {
        ContentIdeaType.BlogPost => Color.Primary,
        ContentIdeaType.Video => Color.Error,
        ContentIdeaType.TweetThread => Color.Info,
        ContentIdeaType.Tutorial => Color.Warning,
        ContentIdeaType.Other => Color.Secondary,
        _ => Color.Default
    };

    private Color GetStatusColor(IdeaStatus status) => status switch
    {
        IdeaStatus.Idea => Color.Info,
        IdeaStatus.InProgress => Color.Warning,
        IdeaStatus.Published => Color.Success,
        _ => Color.Default
    };

    private Color GetPriorityColor(Priority priority) => priority switch
    {
        Priority.High => Color.Error,
        Priority.Medium => Color.Warning,
        Priority.Low => Color.Default,
        _ => Color.Default
    };

    private string GetPriorityStyle(Priority priority) => priority switch
    {
        Priority.High => "background-color: #ffebee; color: #c62828;",
        Priority.Medium => "background-color: #fff8e1; color: #f57f17;",
        Priority.Low => "background-color: #f5f5f5; color: #757575;",
        _ => ""
    };

    private string GetContentTypeChipStyle(ContentIdeaType contentType) => contentType switch
    {
        ContentIdeaType.Video => "background: #ffebee; color: #c62828; font-weight: 500;",
        ContentIdeaType.BlogPost => "background: #e3f2fd; color: #1565c0; font-weight: 500;",
        ContentIdeaType.Tutorial => "background: #fff3e0; color: #e65100; font-weight: 500;",
        ContentIdeaType.TweetThread => "background: #f3e8ff; color: #7b1fa2; font-weight: 500;",
        ContentIdeaType.Other => "background: #e8f5e9; color: #2e7d32; font-weight: 500;",
        _ => "background: #f5f5f5; color: #616161; font-weight: 500;"
    };

    private string GetStatusChipStyle(IdeaStatus status) => status switch
    {
        IdeaStatus.Idea => "background: #e3f2fd; color: #1565c0; font-weight: 500;",
        IdeaStatus.InProgress => "background: #fff3e0; color: #e65100; font-weight: 500;",
        IdeaStatus.Published => "background: #e8f5e9; color: #2e7d32; font-weight: 500;",
        _ => "background: #f5f5f5; color: #616161; font-weight: 500;"
    };

    private string GetPriorityChipStyle(Priority priority) => priority switch
    {
        Priority.High => "background: #ffebee; color: #c62828; font-weight: 500;",
        Priority.Medium => "background: #fff3e0; color: #e65100; font-weight: 500;",
        Priority.Low => "background: #f5f5f5; color: #616161; font-weight: 500;",
        _ => "background: #f5f5f5; color: #616161; font-weight: 500;"
    };
}
